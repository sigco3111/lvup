---

**딴짓하는 동안 레벨업 - 제품 요구사항 문서 (PRD)**

**문서 버전:** 1.2
**작성일:** 2023-10-27
**수정일:** 2024-05-16 (현재 대화 내용 반영)
**작성자:** [AI Product Manager 이름] (초안), [AI Tech Lead 이름] (수정)

---

## 1. 제품 개요

### 1.1. 제품 목적 및 개발 배경

"딴짓하는 동안 레벨업"은 플레이어의 적극적인 조작 개입을 최소화하면서도 RPG의 핵심 재미인 캐릭터 육성의 깊이를 제공하는 것을 목표로 하는 **온라인 방치형 RPG 게임**입니다. 바쁜 현대 사용자들이 게임에 많은 시간을 할애하기 어렵다는 점에 착안, 게임이 자동으로 진행되는 동안에도 사용자는 장비 세팅, 스킬 조합, 직업 선택, 유물 관리 등 전략적인 성장 결정에 집중하여 만족감을 얻을 수 있도록 기획되었습니다. 정통 판타지 세계관을 배경으로, 쉽고 편하게 접근 가능하면서도 깊이 있는 성장 시스템을 통해 지속적인 플레이 동기를 부여하고자 합니다. **오프라인 보상은 지원하지 않으며, 게임이 실행 중인 온라인 상태에서만 성장이 이루어집니다.**

### 1.2. 해결하려는 문제점

*   **시간 부족:** 전통적인 RPG의 많은 시간 투자와 반복 조작 요구.
*   **성장 정체:** 일부 방치형 게임의 부족한 성장 깊이와 빠른 지루함 유발.
*   **복잡성:** 복잡한 조작이나 시스템 이해의 진입 장벽.

### 1.3. 제공 가치 제안

*   **최소한의 조작, 최대한의 성장:** 자동 전투 및 자원 획득으로 피로도 감소, 전략적 결정(장비, 스킬, 직업, 유물)에 집중하여 재미 제공.
*   **깊이 있는 성장 시스템:** 다양한 장비(등급/옵션/세트), 다단계 전직, 영구 패시브 유물 시스템으로 장기적 성장 목표 부여.
*   **접근성 높은 RPG 경험:** 익숙한 판타지 세계관, 직관적 인터페이스, 자동화 시스템으로 쉬운 적응 및 성장 재미 제공.
*   **온라인 방치 보상:** 게임을 켜두는 것만으로 지속적인 성장 가능.

---

## 2. 대상 사용자

*   **라이트 RPG 유저:** 쉽고 간편한 자동 성장 선호.
*   **전략/최적화 선호 유저:** 스펙 최적화 및 결과 확인 선호.
*   **클래식 판타지 팬:** 익숙한 세계관 및 직업 기반 육성 선호.
*   **멀티태스킹 유저:** 다른 작업 중 켜놓을 수 있는 온라인 서브 게임 선호.

---

## 3. 기술 아키텍처 및 스택 (신규 추가)

*   **프레임워크:** Next.js (App Router, **`src` 폴더 미사용**)
*   **UI 라이브러리:** ShadCN (최우선 사용)
*   **스타일링:** TailwindCSS
*   **백엔드 (BaaS):** Supabase
    *   **인증:** Supabase Auth (Google OAuth Provider)
    *   **데이터베이스:** Supabase Postgres
    *   **데이터 접근:** **`supabase-js` 클라이언트 라이브러리 직접 사용 (ORM 미사용)**.
    *   **실시간 기능:** Supabase Realtime (필요시 활용)
*   **API 구현:**
    *   주요 데이터 조회: Next.js Server Components 또는 Route Handlers (`app/api/...`).
    *   데이터 변경/액션: Next.js Server Actions (`actions/...`).
    *   복잡한 트랜잭션/원자성 보장: **PostgreSQL 함수 (DB Functions)** 사용 강력 권장.
*   **배포:** Vercel
*   **개발 방식:** **Front-end first** (UI 우선 구현 후 기능 개발)
*   **프로젝트 구조:** 사용자 요청 기반의 `no-src` 폴더 구조 준수 (상세 구조는 이전 대화 참조).

---

## 4. 사용자 흐름 (주요 시나리오 요약)

1.  **앱 실행 및 로그인:** Google 계정으로 로그인 (Supabase Auth).
2.  **게임 로딩 및 자동 전투 확인:** 메인 대시보드 로드, 캐릭터 자동 전투 시작(몬스터 처치, 재화/경험치/장비 획득).
3.  **성장 요소 알림 확인:** 레벨업, 장비 획득, 전직 가능 등 알림 확인.
4.  **장비 관리:** 인벤토리 확인, 자동/수동 장착, 자동 판매(설정 시), 장비 강화.
5.  **스킬 관리:** 스킬 습득/강화, 스킬 프리셋 사용/저장.
6.  **직업 관리:** 전직 가능 시 전직 진행 (Lv 50, 200, 500).
7.  **유물 관리:** 유물 획득 확인, 장착/해제, 유물 강화.
8.  **모험 지역 선택 (필요시):** 특화 자원 획득 위해 모험 지역 입장/복귀.
9.  **방치 (온라인):** 게임 실행 상태 유지, 자동 전투 및 성장 지속.
10. **주기적 확인 및 관리 반복:** 2~9 과정 반복.

---

## 5. 기능 요구사항

| 기능명                          | 설명                                                                                                                                                            | 개발 난이도 | 우선순위 | 주요 기술/접근 방식                                                                                                                               |
| :------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------- | :------- | :------------------------------------------------------------------------------------------------------------------------------------------------ |
| **인프라 및 계정**              |                                                                                                                                                                 |             |          |                                                                                                                                                   |
| 21. 회원가입/로그인 (구글)      | Supabase Auth (Google) 연동. 사용자 식별 및 데이터 연동.                                                                                                          | 보통        | 상       | Supabase Client (FE), Route Handler (Callback), DB Trigger (Profile 생성)                                                                         |
| 22. Supabase 연동 설정          | Supabase 프로젝트 설정, DB 스키마 정의(SQL), RLS 정책 설정, 클라이언트 초기화.                                                                                     | 보통        | 상       | Supabase Dashboard, SQL, `utils/supabase/...`                                                                                                     |
| 23. Vercel 배포 설정            | Vercel 프로젝트 설정, 환경 변수 구성, 배포 파이프라인.                                                                                                             | 쉬움        | 상       | Vercel Dashboard, `next.config.js`, `.env`                                                                                                      |
| **핵심 기능 (Core Gameplay)**   |                                                                                                                                                                 |             |          |                                                                                                                                                   |
| 1. 캐릭터 기본 시스템           | 캐릭터 레벨, 경험치, 기본 스탯(힘/민첩 등) 정의 및 관리. 레벨업 로직.                                                                                                | 보통        | 상       | `user_characters` 테이블, `game_level_requirements` 테이블, DB 함수 (레벨업 처리)                                                                   |
| 2. 자동 전투 시스템             | 캐릭터 자동 타겟팅, 공격/스킬 사용, 몬스터 전투 로직 (온라인). 시각화 포함.                                                                                         | 보통        | 상       | FE (클라이언트 로직 중심), `BattleScene.tsx`, Server Action (결과 저장)                                                                             |
| 3. 재화/아이템 자동 획득        | 전투 통한 골드, 경험치, 장비 등 자동 획득. UI 반영.                                                                                                                | 쉬움        | 상       | Server Action (`recordLoot`), DB 함수 (`update_user_resources`), FE (UI 업데이트)                                                                 |
| 4. 메인 스테이지 시스템         | 월드-지역-스테이지 구조, 자동 진행, 보스 도전/클리어, 다음 지역 이동.                                                                                                | 보통        | 상       | `game_stages` 테이블, Server Action (`clearStage`), FE (상태 관리, UI)                                                                               |
| 5. 직업 시스템 (기본/1차)     | 8개 기본 직업, Lv 50 1차 전직(2개 분기). 직업별 스탯/스킬 차이.                                                                                                      | 보통        | 상       | `game_jobs` 테이블, Server Action (`changeJob`), FE (전직 UI)                                                                                     |
| 6. 장비 시스템 (기본)           | 7개 슬롯, 등급(일반~전설), 기본/추가 옵션, 드랍 기반 획득. 인벤토리 UI.                                                                                            | 보통        | 상       | `game_items`, `user_inventory` 테이블, Server Actions (`equip/unequip/lock`), FE (인벤토리/상세 UI)                                                     |
| 7. 장비 강화 시스템             | 골드 소모 강화, 레벨별 성공 확률/비용. 기본 능력치 상승 (파괴 없음).                                                                                                | 보통        | 상       | `game_enhancement_rules` 테이블, Server Action (`enhanceItem`), DB 함수 (골드 차감/레벨업 원자성), FE (강화 UI)                                        |
| 8. 스킬 시스템 (기본)           | 스킬 습득/강화(포인트/재화 소모), 액티브 슬롯 장착/해제, 자동 전투 연동.                                                                                           | 보통        | 상       | `game_skills`, `user_skills`, `user_equipped_skills` 테이블, Server Actions (`learn/upgrade/equip/unequip`), FE (스킬 UI, 슬롯 UI)             |
| 9. 기본 UI/UX                   | 메인 화면 레이아웃, 공통 컴포넌트(ShadCN 기반), 필수 인터페이스(인벤토리, 스탯, 스킬 등).                                                                            | 보통        | 상       | ShadCN, TailwindCSS, Next.js Layouts/Components                                                                                                 |
| **중요 부가 기능**              |                                                                                                                                                                 |             |          |                                                                                                                                                   |
| 10. 모험 지역 시스템           | 특정 자원 특화 사냥터. 보스 클리어 시 해금, 지역 선택/진입/복귀 UI.                                                                                                | 보통        | 상       | `game_adventure_zones` 테이블, `user_game_data` 확장, Server Actions (`enter/return`), FE (선택 Dialog)                                               |
| 11. 유물 시스템 (기본)          | 보스 최초 클리어 시 획득, 슬롯 장착(패시브), '고대의 정수' 사용 강화.                                                                                              | 어려움      | 상       | `game_relics`, `user_relics`, `user_equipped_relics`, Server Actions (`acquire/equip/unequip/enhance`), FE (유물 관리 UI)                        |
| 12. 직업 시스템 (2차/3차)     | Lv 200(2차), 500(3차) 전직. 직업 트리 확장, 고유 스킬/패시브 추가.                                                                                                 | 어려움      | 중       | `game_jobs` 데이터 확장, `changeJob` Server Action 로직 확장, FE (UI 데이터 반영)                                                                    |
| 13. 장비 시스템 (심화)          | 신화 등급, 고유 옵션, 세트 효과(영웅 등급 이상) 구현 및 UI 표시.                                                                                                    | 어려움      | 중       | `game_items` 확장, `game_item_sets` 테이블, 스탯 계산 로직 확장, FE (UI 업데이트)                                                                 |
| 14. 편의 기능 (기본)            | 최고 장비 자동 장착, 자동 판매(등급 설정), 장비 비교/잠금 기능.                                                                                                   | 보통        | 중       | Server Actions (`autoEquip`, `saveSettings`, `autoSell`), `user_settings` 테이블, FE (설정 UI, 버튼)                                                 |
| 15. 스킬 프리셋 기능           | 여러 스킬 조합 저장 및 교체 기능.                                                                                                                                | 쉬움        | 중       | `user_skill_presets` 테이블, Server Actions (`save/loadPreset`), DB 함수 (로드 시 원자성), FE (프리셋 UI)                                         |
| **운영 및 관리 도구**           |                                                                                                                                                                 |             |          |                                                                                                                                                   |
| 24. 어드민 시스템               | **내부 웹 기반 도구:** 사용자 조회/관리(제한적), 재화/아이템 지급, 게임 데이터(밸런스 포함) 관리, 운영 로그 기록. **별도 어드민 인증 및 권한 관리 필요.**           | 어려움      | 중       | 별도 `/admin` 경로/UI, 인증/권한 미들웨어, 관리용 API (Route Handlers), `admin_logs` 테이블, RLS 정책 강화                                       |
| 17. 난이도/밸런스 튜닝 지원   | **어드민 기능 확장:** 게임 데이터(몬스터 스펙, 드랍률, 경험치 요구량 등) 편집 UI, 데이터 시각화 도구, 테스트 계정 지원. **지속적 관리 필요.**                       | 어려움      | 상       | 어드민 시스템 내 구현, 데이터 테이블/차트 UI, 관련 API 핸들러, DB 스키마(밸런스 관련 필드)                                                             |
| **추가 고려 기능**              |                                                                                                                                                                 |             |          |                                                                                                                                                   |
| 16. 비주얼/연출 강화            | 직업별 외형, 고등급 장비/강화 이펙트, 스킬 이펙트, 월드 테마 차별화.                                                                                              | 보통        | 중       | FE 중심 (애니메이션, 파티클), 관련 데이터 필드 추가 (BE)                                                                                           |
| 18. 업적 시스템                | 목표 달성 시 보상(재화, 유물, 칭호 등). 플레이 가이드 및 동기 부여.                                                                                                | 보통        | 하       | `game_achievements`, `user_achievements` 테이블, Server Action (`claimReward`), 이벤트 연동 (`updateProgress`), FE (업적 UI, 알림)           |
| 19. 직업 변경 기능             | 동일 티어 내 재화 소모 직업 변경. 스킬 처리 정책 필요.                                                                                                           | 보통        | 하       | `game_jobs` 확장(비용, 그룹), Server Action (`requestJobSwitch`), DB 함수 (트랜잭션), FE (변경 UI)                                                  |
| 20. '고대의 정수' 추가 획득처   | 유물 중복 외 획득 경로 추가 (예: 보스 반복 클리어, 특정 몬스터 드랍).                                                                                             | 쉬움        | 하       | 기존 Server Actions (`recordLoot`, `clearStage`) 수정, DB 함수 (`update_user_resources`) 수정, 관련 테이블 데이터 정의                          |

---

## 6. 데이터베이스 개요 (신규 추가)

Supabase PostgreSQL 데이터베이스를 사용하며, `supabase-js` 클라이언트를 통해 직접 접근합니다. 주요 예상 테이블은 다음과 같습니다 (실제 구현 시 변경/추가될 수 있음):

*   **사용자 관련:** `auth.users` (Supabase 제공), `profiles`, `user_characters`, `user_game_data`, `user_settings`.
*   **인벤토리/장비:** `user_inventory`, `game_items`, `game_item_sets`, `game_enhancement_rules`.
*   **스킬:** `user_skills`, `user_equipped_skills`, `game_skills`, `user_skill_presets`.
*   **직업:** `game_jobs`.
*   **스테이지/월드:** `game_stages`, `game_regions`, `game_worlds`, `user_cleared_stages`.
*   **모험 지역:** `game_adventure_zones`, `user_unlocked_adventure_zones` (또는 `user_game_data` 확장).
*   **몬스터:** `game_monsters`, `game_monster_loot_tables`.
*   **유물:** `user_relics`, `user_equipped_relics`, `game_relics`, `game_relic_enhancement_rules`.
*   **업적:** `user_achievements`, `game_achievements`.
*   **기타:** `game_level_requirements`.
*   **운영:** `admin_logs`.

**참고:** 모든 사용자 데이터 관련 테이블에는 **Row Level Security (RLS)** 정책 설정이 필수입니다. 복잡한 데이터 변경 작업에는 **DB 함수(plpgsql)** 사용을 권장하여 데이터 무결성과 원자성을 확보합니다.

---

## 7. 비기능 요구사항 (신규 추가)

*   **성능:**
    *   자동 전투 및 UI 업데이트 시 프레임 드랍 최소화.
    *   데이터베이스 쿼리 최적화 (인덱싱 활용).
    *   어드민 시스템의 대량 데이터 처리 성능 고려.
*   **보안:**
    *   모든 API 요청에 대한 사용자 인증 및 권한 검증 철저.
    *   Supabase RLS 정책을 통해 데이터 접근 제어 강화.
    *   어드민 시스템 접근 통제 및 모든 액션 로깅.
    *   입력값 검증 (클라이언트/서버 양측).
*   **데이터 무결성:**
    *   재화 변경, 아이템 소모, 레벨업 등 중요한 데이터 변경 시 트랜잭션(DB 함수) 사용 필수.
    *   데이터베이스 제약 조건(FK, Check 등) 적극 활용.
*   **확장성:** 향후 콘텐츠 추가 및 시스템 확장을 고려한 데이터베이스 스키마 및 코드 구조 설계.

---

## 8. 참고사항

*   위 기능 요구사항의 개발 난이도와 우선순위는 조정될 수 있습니다.
*   **어드민 시스템(24번)**과 **밸런스 튜닝 지원(17번)**은 게임의 지속적인 운영 및 개선에 필수적이므로, MVP 이후 가능한 빠르게 구축하는 것을 고려합니다. 초기에는 Supabase 직접 데이터 수정 등으로 대체 가능합니다.
*   디자인 팀과의 긴밀한 협력을 통해 직관적이고 매력적인 UI/UX 구현이 중요합니다.
*   명세서 작성 과정은 **Front-end first** 방식을 따랐으며, 실제 개발 순서도 이를 고려하여 계획되었습니다 (상세 순서는 별도 제공됨).

---
